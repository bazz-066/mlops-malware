import time
from os.path import join, dirname, realpath

from anytree import Node

from core.event_log_parser import EventLogParser
from core.model import Model

EVTX_FILE_PATH = 'C:\Windows\System32\winevt\Logs\Microsoft-Windows-Sysmon%4Operational.evtx'

def main():
    start = time.time()

    root = Node("root", item=[])

    evt = EventLogParser(exported_log_file=EVTX_FILE_PATH, node_root=root)
    evt.get_all_events()

    model = Model(evt.event_logs)
    model.execute()

    end = time.time()

    print('Total processed: ', len(model.get_result()))
    print('Final result: ', model.get_result())
    print('Total events: ', evt.total)
    print('Total time execution: ', end - start)

if __name__ == '__main__':
    main()
